#!/bin/bash
# Lumo Optimized - Benchmarking Helper Script
# This script provides guidance for benchmarking different editions

set -e

echo "========================================"
echo "Lumo Optimized Benchmarking Guide"
echo "========================================"
echo ""
echo "This guide helps you consistently benchmark different editions"
echo "to find the optimal settings for your hardware."
echo ""

echo "=== PREREQUISITES ==="
echo ""
echo "1. Install the edition you want to test"
echo "2. Allocate consistent RAM (recommended: 4-8GB)"
echo "3. Close other applications"
echo "4. Ensure consistent power settings (plugged in for laptops)"
echo ""

echo "=== TEST WORLD SETUP ==="
echo ""
echo "For consistent results, use these settings:"
echo ""
echo "  World Seed: 8675309"
echo "  Game Mode:  Creative (for flying tests)"
echo "  Difficulty: Peaceful (reduces entity variance)"
echo ""
echo "Coordinates for test locations:"
echo "  Spawn Area:     0, 100, 0     (open plains)"
echo "  Dense Forest:   500, 80, 500  (tree rendering)"
echo "  Village:        -200, 70, 300 (entity stress)"
echo "  Cave System:    0, -20, 0     (lighting stress)"
echo "  Ocean:          1000, 63, 0   (water rendering)"
echo ""

echo "=== BENCHMARKING PROCEDURE ==="
echo ""
echo "Step 1: Launch Minecraft and load test world"
echo "Step 2: Wait 60 seconds for chunks to load"
echo "Step 3: Press F3 to show debug screen"
echo ""
echo "Step 4: Run Spark profiler:"
echo "  /spark profiler start"
echo "  [perform test actions for 60 seconds]"
echo "  /spark profiler stop"
echo ""
echo "Step 5: Record metrics:"
echo "  - Average FPS (shown in F3)"
echo "  - 1% Low FPS (from Spark report)"
echo "  - Memory usage (F3 top right)"
echo "  - Chunk render time (F3)"
echo ""

echo "=== TEST SCENARIOS ==="
echo ""
echo "1. STATIC TEST (baseline)"
echo "   - Stand still at spawn (0, 100, 0)"
echo "   - Look at horizon"
echo "   - Record FPS for 30 seconds"
echo ""
echo "2. FLIGHT TEST (chunk loading)"
echo "   - Fly in creative mode"
echo "   - Speed: normal flight (no elytra boost)"
echo "   - Direction: straight line east"
echo "   - Duration: 60 seconds"
echo ""
echo "3. COMBAT TEST (entity stress)"
echo "   - Spawn 50 zombies: /summon zombie ~ ~ ~ {Silent:1}"
echo "   - Record FPS while looking at mob group"
echo "   - Clear: /kill @e[type=zombie]"
echo ""
echo "4. SHADER STRESS TEST"
echo "   - Find water body with sun reflection"
echo "   - Record FPS with shaders on/off"
echo "   - Test at sunrise/sunset for volumetrics"
echo ""

echo "=== SPARK COMMANDS ==="
echo ""
echo "Performance profiling:"
echo "  /spark profiler start          - Start CPU profiler"
echo "  /spark profiler stop           - Stop and generate report"
echo "  /spark profiler --interval 1   - High precision mode"
echo ""
echo "Memory analysis:"
echo "  /spark heapsummary             - Show memory usage"
echo "  /spark heapdump                - Full heap dump"
echo ""
echo "TPS monitoring:"
echo "  /spark tps                     - Show server TPS"
echo "  /spark tickmonitor             - Monitor tick times"
echo ""

echo "=== EDITION COMPARISON TABLE ==="
echo ""
echo "Record your results in this format:"
echo ""
echo "| Edition    | Static FPS | Flight FPS | Combat FPS | Memory | Notes |"
echo "|------------|------------|------------|------------|--------|-------|"
echo "| Standard   |            |            |            |        |       |"
echo "| Steam Deck |            |            |            |        |       |"
echo "| MacBook    |            |            |            |        |       |"
echo "| Mac Studio |            |            |            |        |       |"
echo "| Low-End    |            |            |            |        |       |"
echo "| Medium     |            |            |            |        |       |"
echo "| High-End   |            |            |            |        |       |"
echo ""

echo "=== RECOMMENDED SETTINGS BY FPS ==="
echo ""
echo "If your Static FPS is:"
echo "  < 30 FPS  → Use Low-End edition"
echo "  30-60 FPS → Use Medium edition (consider disabling shaders)"
echo "  60-90 FPS → Use Medium or Standard edition"
echo "  90+ FPS   → Use High-End edition for best visuals"
echo ""
echo "For laptops on battery:"
echo "  MacBook   → Use MacBook edition"
echo "  Others    → Use Low-End or Medium edition"
echo ""
echo "For Steam Deck:"
echo "  Always use Steam Deck edition for controller support"
echo ""

echo "=== ADDITIONAL TIPS ==="
echo ""
echo "1. Test multiple times and average results"
echo "2. Restart Minecraft between edition changes"
echo "3. Check GPU temperatures (throttling affects results)"
echo "4. Disable V-Sync for uncapped FPS testing"
echo "5. Test with render distance 12-16 for fair comparison"
echo ""
echo "For detailed profiling, visit your Spark report URL"
echo "and analyze the flame graph for bottlenecks."
echo ""
